-- ModuleScript: SimpleUI

local SimpleUI = {}
local Components = {}
local WindowVisible = false
local MainGui = nil

-- تخصيص الألوان الافتراضية
SimpleUI.Colors = {
    Background = Color3.fromRGB(35, 35, 35),
    Element = Color3.fromRGB(50, 50, 50),
    Accent = Color3.fromRGB(0, 170, 255),
    Text = Color3.new(1, 1, 1),
}

---
--- @param settings table إعدادات النافذة (Name, Keybind, Scale)
--- @return table الواجهة الرئيسية
function SimpleUI:newWindow(settings)
    -- إعدادات افتراضية
    settings = settings or {}
    local Name = settings.Name or "Custom UI"
    local Keybind = settings.Keybind or Enum.KeyCode.RightControl

    local PlayerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- إنشاء ScreenGui
    MainGui = Instance.new("ScreenGui")
    MainGui.Name = "SimpleUIMainGui"
    MainGui.ResetOnSpawn = false
    
    -- الإطار الرئيسي (النافذة)
    local Window = Instance.new("Frame")
    Window.Name = "MainWindow"
    Window.Size = UDim2.new(0, 300, 0, 400)
    Window.Position = UDim2.fromScale(0.5, 0.5)
    Window.AnchorPoint = Vector2.new(0.5, 0.5)
    Window.BackgroundColor3 = SimpleUI.Colors.Background
    Window.BorderSizePixel = 0
    Window.Visible = WindowVisible
    
    -- إضافة الزاوية الدائرية
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 8)
    Corner.Parent = Window
    
    -- العنوان
    local Title = Instance.new("TextLabel")
    Title.Text = Name
    Title.Font = Enum.Font.SourceSansBold
    Title.TextSize = 20
    Title.TextColor3 = SimpleUI.Colors.Text
    Title.BackgroundColor3 = SimpleUI.Colors.Accent
    Title.Size = UDim2.new(1, 0, 0, 30)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.Parent = Window
    
    -- تنسيق العناصر في عمود (داخل إطار المكونات)
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "Content"
    ContentFrame.Size = UDim2.new(1, -20, 1, -40)
    ContentFrame.Position = UDim2.new(0.5, 0, 0.5, 10)
    ContentFrame.AnchorPoint = Vector2.new(0.5, 0)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Parent = Window
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.Padding = UDim.new(0, 8)
    ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
    ListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
    ListLayout.Parent = ContentFrame

    Window.Parent = MainGui
    MainGui.Parent = PlayerGui

    -- ربط زر الإظهار/الإخفاء
    local UserInputService = game:GetService("UserInputService")
    UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
        if input.KeyCode == Keybind and not gameProcessedEvent then
            WindowVisible = not WindowVisible
            Window.Visible = WindowVisible
        end
    end)
    
    return Window
end

---
--- @param parent Frame الإطار الذي سيتم إضافة زر التبديل إليه
--- @param name string اسم الميزة
--- @param default boolean القيمة الافتراضية
--- @param callback function الدالة التي يتم استدعاؤها عند التبديل
--- @return table يحتوي على (ToggleElement, State)
function SimpleUI:AddToggle(parent, name, default, callback)
    local CurrentState = default or false
    
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Name = name:gsub("%s+", "") .. "Toggle"
    ToggleFrame.Size = UDim2.new(1, 0, 0, 25)
    ToggleFrame.BackgroundTransparency = 1
    ToggleFrame.Parent = parent.Content

    -- اسم الميزة
    local Label = Instance.new("TextLabel")
    Label.Text = name
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.Font = Enum.Font.SourceSans
    Label.TextSize = 16
    Label.TextColor3 = SimpleUI.Colors.Text
    Label.BackgroundTransparency = 1
    Label.Parent = ToggleFrame

    -- زر التبديل الفعلي
    local Button = Instance.new("TextButton")
    Button.Text = ""
    Button.Size = UDim2.new(0, 40, 0, 20)
    Button.Position = UDim2.new(1, 0, 0.5, 0)
    Button.AnchorPoint = Vector2.new(1, 0.5)
    Button.BackgroundColor3 = CurrentState and SimpleUI.Colors.Accent or SimpleUI.Colors.Element
    Button.BorderSizePixel = 0
    Button.Parent = ToggleFrame
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(1, 0) -- دائري
    Corner.Parent = Button
    
    -- تحديث حالة الزر
    local function updateColor()
        Button.BackgroundColor3 = CurrentState and SimpleUI.Colors.Accent or SimpleUI.Colors.Element
    end

    -- ربط حدث الضغط
    Button.MouseButton1Click:Connect(function()
        CurrentState = not CurrentState
        updateColor()
        if callback then
            callback(CurrentState)
        end
    end)
    
    return {ToggleElement = ToggleFrame, GetState = function() return CurrentState end}
end

return SimpleUI
